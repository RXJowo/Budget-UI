<ion-header>
  <ion-toolbar>
    <ion-title>Expenses</ion-title>
    <ion-buttons slot="end">
      <ion-badge>{{ monthTotal() | currency:'CHF':'symbol':'1.2-2' }}</ion-badge>
    </ion-buttons>
  </ion-toolbar>

  <!-- Filter-Toolbar -->
  <ion-toolbar class="filters-toolbar">
    <div class="toolbar-controls">
      <!-- Sort -->
      <ion-select
        interface="popover"
        [value]="sortKey()"
        (ionChange)="sortKey.set($event.detail.value)"
      >
        <ion-icon slot="start" name="stats-chart-outline"></ion-icon>
        <ion-select-option value="date-desc">Date (newest first)</ion-select-option>
        <ion-select-option value="date-asc">Date (oldest first)</ion-select-option>
        <ion-select-option value="amount-desc">Amount (high → low)</ion-select-option>
        <ion-select-option value="amount-asc">Amount (low → high)</ion-select-option>
      </ion-select>

      <!-- Category -->
      <ion-select
        interface="popover"
        [value]="category()"
        (ionChange)="category.set($event.detail.value)"
      >
        <ion-icon slot="start" name="pricetag-outline"></ion-icon>
        <ion-select-option value="all">Category</ion-select-option>
        <ion-select-option *ngFor="let c of categories()" [value]="c">{{ c }}</ion-select-option>
      </ion-select>

      <!-- Search -->
      <ion-searchbar
        placeholder="Search"
        [value]="query()"
        (ionInput)="query.set($event.detail.value ?? '')"
        show-clear-button="always"
      ></ion-searchbar>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-list lines="full">
    <ion-item *ngIf="groupedByDay().length === 0">
      <ion-label>
        <h2>Keine Ausgaben</h2>
        <p>Wechsle unten den Monat oder passe die Filter an.</p>
      </ion-label>
    </ion-item>

    <!-- Tagesgruppen -->
    <ng-container *ngFor="let group of groupedByDay()">
      <ion-item class="day-divider">
        <ion-label>
          <ion-note>{{ group.dayLabel }}</ion-note>
        </ion-label>
      </ion-item>

      <ion-item *ngFor="let exp of group.items">
        <ion-label>
          <h2>{{ exp.title }}</h2>
          <p>
            <ion-chip size="small">{{ exp.category }}</ion-chip>
            <ion-note>{{ exp.date | date:'shortTime' }}</ion-note>
            <ion-note *ngIf="exp.note">• {{ exp.note }}</ion-note>
          </p>
        </ion-label>

        <ion-note class="amount" slot="end">
          {{ exp.amount | currency:'CHF':'symbol':'1.2-2' }}
        </ion-note>
        <ion-icon name="chevron-forward" slot="end"></ion-icon>
      </ion-item>
    </ng-container>
  </ion-list>

  <!-- FAB -->
  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button color="primary">
      <ion-icon name="add-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>

<!-- Footer -->
<ion-footer>
  <ion-toolbar class="bottom-toolbar">
    <ion-buttons slot="start">
      <ion-button (click)="addMonths(-1)">
        <ion-icon name="chevron-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>

    <div class="footer-title">{{ date | date:'MMMM yyyy' }}</div>

    <ion-buttons slot="end">
      <ion-button (click)="addMonths(1)">
        <ion-icon name="chevron-forward-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>
