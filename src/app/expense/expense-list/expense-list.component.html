<ion-header [translucent]="false">
  <ion-toolbar>
    <ion-title>Expenses</ion-title>
  </ion-toolbar>
  
  <ion-toolbar>
    @if (loading) {
      <ion-progress-bar type="indeterminate" />
    }
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Refresher -->
  <ion-refresher slot="fixed" [disabled]="loading" (ionRefresh)="reloadExpenses($event)">
    <ion-refresher-content />
  </ion-refresher>

  <ion-grid class="ion-padding" [formGroup]="searchForm">
    <!-- Search & Sort & Filter -->
    <ion-row>
      <ion-col size="12" size-sm="4">
        <ion-item>
          <ion-icon name="swap-vertical" slot="start" />
          <ion-select interface="popover" formControlName="sort">
            @for (sortOption of sortOptions; track sortOption.label) {
              <ion-select-option [value]="sortOption.value">
                {{ sortOption.label }}
              </ion-select-option>
            }
          </ion-select>
        </ion-item>
      </ion-col>
      <ion-col size="12" size-sm="4">
        <ion-item>
          <ion-icon name="pricetag" slot="start" />
          <ion-select interface="popover" formControlName="category" placeholder="Category">
            <ion-select-option [value]="null">All Categories</ion-select-option>
            @for (category of categories; track category.id) {
              <ion-select-option [value]="category.id">
                {{ category.name }}
              </ion-select-option>
            }
          </ion-select>
        </ion-item>
      </ion-col>
      <ion-col size="12" size-sm="4">
        <ion-item>
          <ion-icon name="search" slot="start" />
          <ion-input 
            maxlength="40" 
            placeholder="Search" 
            formControlName="name" 
            [clearInput]="true" 
          />
        </ion-item>
      </ion-col>
    </ion-row>

    <!-- Expense List -->
    <ion-row>
      <ion-col>
        @switch (expenses?.length) {
          <!-- Skeleton -->
          @case (null) {
            @for (i of [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]; track i) {
              <ion-item>
                <ion-label>
                  <ion-skeleton-text style="width: 60%" [animated]="true" />
                  <ion-skeleton-text style="width: 40%; margin-top: 4px;" [animated]="true" />
                </ion-label>
                <ion-skeleton-text slot="end" style="width: 80px" [animated]="true" />
              </ion-item>
            }
          }

          <!-- Empty List -->
          @case (0) {
            <ion-item>
              <ion-icon slot="start" name="alert-circle-outline" />
              <ion-label> No expenses found </ion-label>
            </ion-item>
          }

          <!-- Expenses -->
          @default {
            @for (expense of expenses; track expense.id) {
              <ion-item button="true" [detail]="true" (click)="openModal(expense)">
                <ion-label>
                  <h2>{{ expense.name }}</h2>
                  <p>
                    <ion-icon name="pricetag" />
                    {{ getCategoryName(expense.categoryId) }}
                  </p>
                </ion-label>
                <div slot="end" class="amount">
                  CHF {{ expense.amount | number:'1.2-2' }}
                </div>
              </ion-item>
            }
          }
        }
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Infinite Scroll -->
  <ion-infinite-scroll [disabled]="lastPageReached" (ionInfinite)="loadNextExpensePage($event)">
    <ion-infinite-scroll-content />
  </ion-infinite-scroll>

  <!-- FAB Button -->
  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button (click)="openExpenseModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <div class="footer-content">
      <ion-button fill="clear" (click)="addMonths(-1)" class="month-nav">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
      
      <div class="month-title">{{ date | date: "MMMM yyyy" }}</div>
      
      <ion-button fill="clear" (click)="addMonths(1)" class="month-nav">
        <ion-icon name="arrow-forward" slot="icon-only"></ion-icon>
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>

<style>


  /* Header */
  ion-header ion-toolbar {
    --border-color: transparent;
    --min-height: 56px;
  }

  ion-header ion-title {
    font-size: 18px;
    font-weight: 500;
    padding-left: 8px;
  }



  /* Expense List Items */
  ion-item h2 {
    font-size: 16px;
    font-weight: 400;
    margin: 0 0 4px 0;
  }

  ion-item p {
    font-size: 13px;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  ion-item p ion-icon {
    font-size: 14px;
  }

  .amount {
    font-size: 15px;
    font-weight: 500;
  }

  /* Footer */
  ion-footer ion-toolbar {
    --border-color: transparent;
    --min-height: 56px;
  }

  .footer-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 8px;
    height: 56px;
  }

  .month-title {
    font-size: 16px;
    font-weight: 500;
    flex: 1;
    text-align: center;
  }

  .month-nav {
    min-width: 48px;
    height: 48px;
  }

  .month-nav ion-icon {
    font-size: 22px;
  }

  /* FAB Button */
  ion-fab-button {
    width: 56px;
    height: 56px;
  }

  ion-fab-button ion-icon {
    font-size: 26px;
  }
</style>