<ion-header [translucent]="false">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="cancel()" fill="clear" color="medium">
        <ion-icon name="close-outline" slot="start"></ion-icon>
        CANCEL
      </ion-button>
    </ion-buttons>

    <ion-title>{{ expense?.id ? 'Edit' : 'Add' }} Expense</ion-title>

    <ion-buttons slot="end">
      <ion-button 
        [disabled]="expenseForm.invalid" 
        (click)="save()" 
        fill="clear" 
        color="medium">
        <ion-icon name="save-outline" slot="start"></ion-icon>
        SAVE
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" [formGroup]="expenseForm">
  <ion-list lines="full" class="expense-form">

    <!-- Name -->
    <ion-item class="form-item">
      <ion-icon name="text-outline" slot="start" class="item-icon"></ion-icon>
      <ion-input
        #nameInput
        formControlName="name"
        class="item-input"
        placeholder="Name"
        [clearInput]="true">
      </ion-input>
    </ion-item>
    
    <!-- Name Validation Errors -->
    @if (expenseForm.get('name')?.touched && expenseForm.get('name')?.invalid) {
      <div class="error-message">
        @if (expenseForm.get('name')?.hasError('required')) {
          Name is required
        }
        @if (expenseForm.get('name')?.hasError('maxlength')) {
          Name must be less than 40 characters
        }
      </div>
    }

    <!-- Category -->
    <ion-item button class="form-item" (click)="showCategoryModal()">
      <ion-icon name="pricetag-outline" slot="start" class="item-icon"></ion-icon>
      <ion-label class="category-label">
        {{ selectedCategory?.name || 'Category' }}
      </ion-label>
      <ion-icon name="chevron-down-outline" slot="end" class="chevron-icon"></ion-icon>
      <ion-button fill="solid" slot="end" class="add-button" (click)="showCategoryModal(); $event.stopPropagation()">
        <ion-icon name="add-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-item>

    <!-- Amount -->
    <ion-item class="form-item">
      <ion-icon name="cash-outline" slot="start" class="item-icon"></ion-icon>
      <ion-input
        formControlName="amount"
        class="item-input"
        type="number"
        inputmode="decimal"
        placeholder="Amount"
        [clearInput]="true">
      </ion-input>
      <ion-label slot="end" class="currency-label">CHF</ion-label>
    </ion-item>
    
    <!-- Amount Validation Errors -->
    @if (expenseForm.get('amount')?.touched && expenseForm.get('amount')?.invalid) {
      <div class="error-message">
        @if (expenseForm.get('amount')?.hasError('required')) {
          Amount is required
        }
        @if (expenseForm.get('amount')?.hasError('min')) {
          Amount must be greater than 0
        }
      </div>
    }

    <!-- Date -->
    <ion-item class="form-item">
      <ion-icon name="calendar-outline" slot="start" class="item-icon"></ion-icon>
      <ion-datetime-button datetime="expense-date" class="date-button"></ion-datetime-button>
    </ion-item>

  </ion-list>

  <!-- Date picker -->
  <ion-modal [keepContentsMounted]="true">
    <ng-template>
      <ion-datetime
        id="expense-date"
        presentation="date"
        formControlName="date"
        [showDefaultButtons]="true">
      </ion-datetime>
    </ng-template>
  </ion-modal>
</ion-content>

<style>
  /* Header */
  ion-header ion-toolbar {
    padding: 4px 0;
  }

  ion-header ion-title {
    font-size: 17px;
    font-weight: 500;
    text-align: center;
  }

  ion-header ion-button {
    font-size: 13px;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    --border-radius: 0;
    --ripple-color: transparent;
  }

  ion-header ion-button::part(native) {
    border-radius: 0;
  }

  ion-header ion-button ion-icon {
    font-size: 18px;
    margin-right: 6px;
  }

  /* List layout */
  .expense-form {
    padding: 0;
    background: transparent;
    margin-top: 0;
  }

  .form-item {
    --inner-padding-start: 16px;
    --inner-padding-end: 16px;
    --padding-start: 16px;
    --padding-end: 16px;
    --min-height: 52px;
    margin: 0;
  }

  .item-icon {
    font-size: 22px;
    margin-right: 16px;
  }

  .item-input {
    --padding-start: 0;
    --padding-end: 0;
    --padding-top: 0;
    --padding-bottom: 0;
    font-size: 16px;
  }

  ion-input::part(native) {
    padding: 0 !important;
  }

  /* Category */
  .category-label {
    font-size: 16px;
    margin: 0;
  }

  .chevron-icon {
    font-size: 16px;
    margin-right: 8px;
  }

  /* Add button for category */
  .add-button {
    --border-radius: 6px;
    --padding-start: 0;
    --padding-end: 0;
    width: 32px;
    height: 32px;
    margin-left: 8px;
  }

  .add-button ion-icon {
    font-size: 18px;
  }

  /* Currency label */
  .currency-label {
    font-size: 16px;
    margin: 0;
  }

  /* Validation Error Messages */
  .error-message {
    color: var(--ion-color-danger);
    padding: 8px 16px;
    font-size: 14px;
    margin-left: 38px; /* Align with input field after icon */
  }

  /* Date button */
  .date-button {
    margin: 0;
    padding: 0;
  }

  ion-datetime-button::part(native) {
    border-radius: 6px;
    padding: 6px 14px;
    font-size: 15px;
    font-weight: 400;
  }

  @media (min-width: 768px) {
    .expense-form {
      max-width: 600px;
      margin: 0 auto;
    }
  }
</style>